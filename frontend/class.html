<!DOCTYPE html>
<html>
<head>
    <title>Class View</title>
    <meta charset="UTF-8" />
    <script>
        async function loadClass() {
            // 1. Read class_id from URL
            const params = new URLSearchParams(window.location.search);
            const classId = params.get("class_id");
            if (!classId) {
                document.body.innerHTML = "<h2>Invalid Class ID</h2>";
                return;
            }

            // 2. Fetch class info
            const classRes = await fetch(`http://127.0.0.1:8000/api/class-info/${classId}`);
            const classData = await classRes.json();

            if (classData.error) {
                document.body.innerHTML = "<h2>Class not found</h2>";
                return;
            }

            // Show class details
            document.getElementById("class_title").innerHTML =
                `${classData.subject} (${classData.section})`;

            // 3. Fetch students in that section
            const studentRes = await fetch(`http://127.0.0.1:8000/api/students/${classData.section}`);
            const students = await studentRes.json();

            const list = document.getElementById("student_list");

            if (students.length === 0) {
                list.innerHTML = "<p>No students found for this section.</p>";
                return;
            }

            // 4. Render student list
            students.forEach(s => {
                const div = document.createElement("div");
                div.className = "student_card";
                div.innerHTML = `
                    <strong>${s.student_name}</strong><br>
                    USN: ${s.usn}
                `;
                list.appendChild(div);
            });
        }
    </script>

    <style>
        body {
            font-family: Arial;
            padding: 20px;
            background: #fafafa;
        }
        .student_card {
            padding: 12px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body onload="loadClass()">

    <h2 id="class_title">Loading...</h2>
    <h3>Student List</h3>

    <div id="student_list"></div>

</body>

</html>
